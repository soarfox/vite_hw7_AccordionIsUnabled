import{_ as k,r as g,o as n,c as d,a as t,F as v,g as I,h as i,t as c,b as r,w as x,d as f,j as C,v as y,n as b}from"./index-a7a29e29.js";const{VITE_API:u,VITE_APIPATH:m}={VITE_API:"https://vue3-course-api.hexschool.io/v2",VITE_APIPATH:"cheetah116",BASE_URL:"/vite_hw7_AccordionIsUnabled/",MODE:"production",DEV:!1,PROD:!0},O={data(){return{testTesting:"test 123456789",isLoading:!0,loadingColor:"#FFC78E",loadingBackgroundColor:"#FFFAF4",apiUrl:"https://vue3-course-api.hexschool.io/v2",apiPath:"cheetah116",products:[],pageObj:{},singleProduct:{},singleCartData:{},cartList:[],cartProducts:[],formOrder:{user:{email:"",name:"",tel:"",address:""},message:""},loadingStatus:{loadingItem:""}}},methods:{getCartList(){this.$http.get(`${u}/api/${m}/cart`).then(o=>{this.cartList=o.data.data,this.cartProducts=this.cartList.carts}).catch(o=>{console.dir(o)})},removeCartItem(o){this.loadingStatus.loadingItem=o,this.$http.delete(`${u}/api/${m}/cart/${o}`).then(s=>{this.loadingStatus.loadingItem="",alert("已刪除該產品"),this.getCartList()}).catch(s=>{alert(s.data.message)})},deleteAllCartItem(){this.$http.delete(`${u}/api/${m}/carts`).then(o=>{alert("已清空購物車"),this.getCartList()}).catch(o=>{alert(o.data.message)})},updateCart(o){this.loadingStatus.loadingItem=o.id,this.singleCartData.product_id=o.product_id,this.singleCartData.qty=o.qty,this.$http.put(`${u}/api/${m}/cart/${o.id}`,{data:this.singleCartData}).then(s=>{this.loadingStatus.loadingItem="",alert("已更新購物車"),this.getCartList()}).catch(s=>{this.loadingStatus.loadingItem="",alert(s.data.message)})},createOrder(){this.cartProducts.length===0?alert("購物車內無品項, 無法送出訂單"):this.$http.post(`${u}/api/${m}/order`,{data:this.formOrder}).then(o=>{alert("已送出訂單"),this.getCartList(),this.$refs.formContent.resetForm(),this.formOrder.message=""}).catch(o=>{alert(o.data.message)})}},components:{},mounted(){this.getCartList()}},P={class:"container col-8 my-5"},S={key:0},A=t("h2",{class:"text-center fw-bolder"},"購物車清單",-1),E={class:"table align-middle table-hover"},w=t("thead",null,[t("tr",null,[t("th"),t("th",null,"品名"),t("th",null,"單價"),t("th",{class:"text-center"},"數量/單位"),t("th",{class:"text-end"},"金額小計")])],-1),U=["onClick","disabled"],D={key:0,class:"fas fa-spinner fa-pulse"},F={key:0,class:"text-success"},T={class:"input-group input-group-sm"},q={class:"input-group mb-3"},B=["onUpdate:modelValue","onBlur","disabled"],N={class:"input-group-text",id:"basic-addon2"},R={class:"text-end"},j={key:0,class:"text-success"},H=t("td",{colspan:"4",class:"text-end"},"總計",-1),M={class:"text-end"},$={key:0},z=t("td",{colspan:"4",class:"text-end text-success"},"折扣價",-1),G={class:"text-end text-success"},J={class:"text-end"},K=["disabled"],Q={key:1,class:"card"},W={class:"card-body text-center"},X=t("h5",{class:"card-title"},"購物車是空的",-1),Y=t("hr",null,null,-1),Z={class:"my-5 row justify-content-center"},tt=t("h3",{class:"text-center fw-bolder"},"請填寫訂購資訊",-1),et={class:"mb-3"},st=t("label",{for:"name",class:"form-label"},"姓名",-1),lt={class:"mb-3"},ot=t("label",{for:"email",class:"form-label"},"Email",-1),at={class:"mb-3"},rt=t("label",{for:"tel",class:"form-label"},"電話 (請輸入09開頭的手機號碼)",-1),nt={class:"mb-3"},dt=t("label",{for:"address",class:"form-label"},"地址",-1),it={class:"mb-3"},ct=t("label",{for:"message",class:"form-label"},"留言",-1),ut=t("div",{class:"text-end"},[t("button",{class:"btn btn-danger",type:"submit"},"送出訂單")],-1);function mt(o,s,ht,_t,e,h){const V=g("RouterLink"),_=g("v-field"),p=g("error-message"),L=g("v-form");return n(),d(v,null,[t("div",P,[this.cartProducts.length?(n(),d("div",S,[A,t("table",E,[w,t("tbody",null,[e.cartList?(n(!0),d(v,{key:0},I(e.cartProducts,l=>(n(),d("tr",{key:l.id},[t("td",null,[t("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:a=>h.removeCartItem(l.id),disabled:e.loadingStatus.loadingItem===l.id},[e.loadingStatus.loadingItem===l.id?(n(),d("i",D)):i("",!0),f(" x ")],8,U)]),t("td",null,[f(c(l.product.title)+" ",1),l.coupon?(n(),d("div",F," 已套用優惠券 ")):i("",!0)]),t("td",null,c(l.product.price),1),t("td",null,[t("div",T,[t("div",q,[C(t("input",{"onUpdate:modelValue":a=>l.qty=a,min:"1",type:"number",class:"form-control text-end",onBlur:a=>h.updateCart(l),disabled:e.loadingStatus.loadingItem===l.id},null,40,B),[[y,l.qty,void 0,{number:!0}]]),t("span",N,c(l.product.unit),1)])])]),t("td",R,[e.cartList.total!==e.cartList.final_total?(n(),d("small",j,"折扣價：")):i("",!0),f(" "+c(l.final_total),1)])]))),128)):i("",!0)]),t("tfoot",null,[t("tr",null,[H,t("td",M,c(e.cartList.total),1)]),e.cartList.total!==e.cartList.final_total?(n(),d("tr",$,[z,t("td",G,c(e.cartList.final_total),1)])):i("",!0)])]),t("div",J,[t("button",{class:"btn btn-outline-secondary",type:"button",onClick:s[0]||(s[0]=l=>h.deleteAllCartItem()),disabled:!this.cartProducts.length},"清空購物車",8,K)])])):i("",!0),this.cartProducts.length?i("",!0):(n(),d("div",Q,[t("div",W,[X,Y,r(V,{to:"/products",class:"btn btn-danger w-60"},{default:x(()=>[f(" 按我去選購 ")]),_:1})])]))]),t("div",Z,[tt,r(L,{ref:"formContent",class:"col-md-6",onSubmit:s[6]||(s[6]=l=>h.createOrder())},{default:x(({errors:l})=>[t("div",et,[st,r(_,{id:"name",name:"姓名",type:"text",class:b(["form-control",{"is-invalid":l.姓名}]),rules:"required",modelValue:e.formOrder.user.name,"onUpdate:modelValue":s[1]||(s[1]=a=>e.formOrder.user.name=a),placeholder:"請輸入姓名"},null,8,["modelValue","class"]),r(p,{name:"姓名",class:"invalid-feedback"})]),t("div",lt,[ot,r(_,{id:"email",name:"email",type:"email",class:b(["form-control",{"is-invalid":l.email}]),rules:"email|required",modelValue:e.formOrder.user.email,"onUpdate:modelValue":s[2]||(s[2]=a=>e.formOrder.user.email=a),placeholder:"請輸入Email"},null,8,["modelValue","class"]),r(p,{name:"email",class:"invalid-feedback"})]),t("div",at,[rt,r(_,{id:"tel",name:"電話",type:"tel",class:b(["form-control",{"is-invalid":l.電話}]),rules:{regex:/^(09)[0-9]{8}$/,required:!0},modelValue:e.formOrder.user.tel,"onUpdate:modelValue":s[3]||(s[3]=a=>e.formOrder.user.tel=a),placeholder:"請輸入電話"},null,8,["rules","modelValue","class"]),r(p,{name:"電話",class:"invalid-feedback"})]),t("div",nt,[dt,r(_,{id:"address",name:"地址",type:"text",class:b(["form-control",{"is-invalid":l.地址}]),rules:"required",modelValue:e.formOrder.user.address,"onUpdate:modelValue":s[4]||(s[4]=a=>e.formOrder.user.address=a),placeholder:"請輸入地址"},null,8,["modelValue","class"]),r(p,{name:"地址",class:"invalid-feedback"})]),t("div",it,[ct,C(t("textarea",{id:"message",name:"message",class:"form-control",cols:"30",rows:"10","onUpdate:modelValue":s[5]||(s[5]=a=>e.formOrder.message=a),placeholder:"請輸入留言"},`
                  `,512),[[y,e.formOrder.message]])]),ut]),_:1},512)])],64)}const gt=k(O,[["render",mt]]);export{gt as default};
