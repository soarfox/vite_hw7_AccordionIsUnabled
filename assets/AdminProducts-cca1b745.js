import{_ as y,o as s,c as i,a as t,j as a,v as c,F as M,g as k,k as D,i as I,t as P,M as w,r as f,b as v}from"./index-9e760e5b.js";import{P as x}from"./paginationComponent-3ec8dd61.js";const C={props:["tempProduct","isAddProduct","createImagesUrlArray","closeProductModalWindow","singleFileUpload"],data(){return{modalProduct:{}}},watch:{tempProduct:{handler(d,e){this.modalProduct=d},deep:!0}}},V={id:"productModal",ref:"productModal",class:"modal fade",tabindex:"-1","aria-labelledby":"productModalLabel","aria-hidden":"true"},F={class:"modal-dialog modal-xl"},S={class:"modal-content border-0"},E={class:"modal-header bg-dark text-white"},O={id:"productModalLabel",class:"modal-title"},R={key:0},$={key:1},T=t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),B={class:"modal-body"},N={class:"row"},L={class:"col-sm-4"},j={class:"mb-2"},W=t("h3",{class:"mb-3"},"主要圖片",-1),q={class:"mb-3"},H=t("label",{for:"imageUrl",class:"form-label"},"主要圖片的網址",-1),J=["src"],z=t("h3",{class:"mb-3"},"新增多張圖片",-1),G={key:0},K=t("label",{class:"form-label"},"圖片網址",-1),Q=["onUpdate:modelValue"],X=["src"],Y={key:0},Z={key:1},tt={key:1},et={class:"col-sm-8"},ot={class:"mb-3"},lt=t("label",{for:"title",class:"form-label"},"標題",-1),dt={class:"row"},st={class:"mb-3 col-md-6"},it=t("label",{for:"category",class:"form-label"},"分類",-1),rt={class:"mb-3 col-md-6"},nt=t("label",{for:"unit",class:"form-label"},"單位",-1),at={class:"row"},ct={class:"mb-3 col-md-6"},ut=t("label",{for:"origin_price",class:"form-label"},"原價",-1),mt={class:"mb-3 col-md-6"},pt=t("label",{for:"price",class:"form-label"},"售價",-1),ht=t("hr",null,null,-1),_t={class:"mb-3"},bt=t("label",{for:"description",class:"form-label"},"產品描述",-1),Pt={class:"mb-3"},gt=t("label",{for:"content",class:"form-label"},"說明內容",-1),ft={class:"mb-3 col-md-6"},vt=t("label",{for:"productRatingStars",class:"form-label"},"商品評價星級",-1),yt={class:"mb-3"},Ut={class:"form-check"},wt=t("label",{class:"form-check-label",for:"is_enabled"},"是否啟用",-1),Mt={class:"modal-footer"};function kt(d,e,r,U,o,n){return s(),i("div",V,[t("div",F,[t("div",S,[t("div",E,[t("h5",O,[r.isAddProduct?(s(),i("span",R,"新增產品")):(s(),i("span",$,"編輯產品"))]),T]),t("div",B,[t("div",N,[t("div",L,[t("div",j,[W,t("div",null,[t("input",{type:"file",class:"form-control",id:"pic_file_uploadField",placeholder:"請選擇圖片或將圖片拖曳進來",onChange:e[0]||(e[0]=l=>r.singleFileUpload())},null,32)]),t("div",q,[H,a(t("input",{type:"text",class:"form-control",placeholder:"請輸入主要圖片的網址","onUpdate:modelValue":e[1]||(e[1]=l=>o.modalProduct.imageUrl=l)},null,512),[[c,o.modalProduct.imageUrl]])]),t("img",{class:"img-fluid",src:o.modalProduct.imageUrl,alt:""},null,8,J)]),z,Array.isArray(o.modalProduct.imagesUrl)?(s(),i("div",G,[(s(!0),i(M,null,k(o.modalProduct.imagesUrl,(l,p)=>(s(),i("div",{class:"mb-1",key:p},[t("div",null,[K,a(t("input",{"onUpdate:modelValue":g=>o.modalProduct.imagesUrl[p]=g,type:"text",class:"form-control",placeholder:"請輸入圖片的網址"},null,8,Q),[[c,o.modalProduct.imagesUrl[p]]])]),t("img",{class:"img-fluid",src:l},null,8,X)]))),128)),o.modalProduct.imagesUrl.length===0||o.modalProduct.imagesUrl[o.modalProduct.imagesUrl.length-1]?(s(),i("div",Y,[t("button",{class:"btn btn-outline-primary btn-sm d-block w-100",onClick:e[2]||(e[2]=l=>o.modalProduct.imagesUrl.push(""))}," 新增圖片 ")])):(s(),i("div",Z,[t("button",{class:"btn btn-outline-danger btn-sm d-block w-100",onClick:e[3]||(e[3]=l=>o.modalProduct.imagesUrl.pop())}," 刪除圖片 ")]))])):(s(),i("div",tt,[t("button",{class:"btn btn-outline-primary btn-sm d-block w-100",onClick:e[4]||(e[4]=(...l)=>r.createImagesUrlArray&&r.createImagesUrlArray(...l))}," 新增圖片 ")]))]),t("div",et,[t("div",ot,[lt,a(t("input",{id:"title",type:"text",class:"form-control",placeholder:"請輸入標題","onUpdate:modelValue":e[5]||(e[5]=l=>o.modalProduct.title=l)},null,512),[[c,o.modalProduct.title]])]),t("div",dt,[t("div",st,[it,a(t("input",{id:"category",type:"text",class:"form-control",placeholder:"請輸入分類","onUpdate:modelValue":e[6]||(e[6]=l=>o.modalProduct.category=l)},null,512),[[c,o.modalProduct.category]])]),t("div",rt,[nt,a(t("input",{id:"unit",type:"text",class:"form-control",placeholder:"請輸入單位","onUpdate:modelValue":e[7]||(e[7]=l=>o.modalProduct.unit=l)},null,512),[[c,o.modalProduct.unit]])])]),t("div",at,[t("div",ct,[ut,a(t("input",{id:"origin_price",type:"number",min:"0",class:"form-control",placeholder:"請輸入原價","onUpdate:modelValue":e[8]||(e[8]=l=>o.modalProduct.origin_price=l)},null,512),[[c,o.modalProduct.origin_price,void 0,{number:!0}]])]),t("div",mt,[pt,a(t("input",{id:"price",type:"number",min:"0",class:"form-control",placeholder:"請輸入售價","onUpdate:modelValue":e[9]||(e[9]=l=>o.modalProduct.price=l)},null,512),[[c,o.modalProduct.price,void 0,{number:!0}]])])]),ht,t("div",_t,[bt,a(t("textarea",{id:"description",type:"text",class:"form-control",placeholder:"請輸入產品描述","onUpdate:modelValue":e[10]||(e[10]=l=>o.modalProduct.description=l)},`\r
                 `,512),[[c,o.modalProduct.description]])]),t("div",Pt,[gt,a(t("textarea",{id:"content",type:"text",class:"form-control",placeholder:"請輸入說明內容","onUpdate:modelValue":e[11]||(e[11]=l=>o.modalProduct.content=l)},`\r
                 `,512),[[c,o.modalProduct.content]])]),t("div",ft,[vt,a(t("input",{id:"productRatingStars",type:"number",class:"form-control",placeholder:"請輸入評價星級(1~5)","onUpdate:modelValue":e[12]||(e[12]=l=>o.modalProduct.productRatingStars=l)},null,512),[[c,o.modalProduct.productRatingStars,void 0,{number:!0}]])]),t("div",yt,[t("div",Ut,[wt,a(t("input",{id:"is_enabled",class:"form-check-input",type:"checkbox","true-value":1,"false-value":0,"onUpdate:modelValue":e[13]||(e[13]=l=>o.modalProduct.is_enabled=l)},null,512),[[D,o.modalProduct.is_enabled]])])])])])]),t("div",Mt,[t("button",{type:"button",class:"btn btn-outline-secondary",onClick:e[14]||(e[14]=l=>r.closeProductModalWindow())}," 取消 "),t("button",{type:"button",class:"btn btn-primary",onClick:e[15]||(e[15]=I(l=>d.$emit("send-new-product-data-from-modal",o.modalProduct),["prevent"]))}," 確認 ")])])])],512)}const At=y(C,[["render",kt]]),Dt={props:["tempItem","deleteProduct","closeDeleteModalWindow"]},It={id:"delProductModal",ref:"delProductModal",class:"modal fade",tabindex:"-1","aria-labelledby":"delProductModalLabel","aria-hidden":"true"},xt={class:"modal-dialog"},Ct={class:"modal-content border-0"},Vt={class:"modal-header bg-danger text-white"},Ft=t("h5",{id:"delProductModalLabel",class:"modal-title"},[t("span",null,"刪除產品")],-1),St={class:"modal-body"},Et=t("strong",{class:"text-danger"},"(一經刪除，將無法恢復)。",-1),Ot={class:"modal-footer"};function Rt(d,e,r,U,o,n){return s(),i("div",It,[t("div",xt,[t("div",Ct,[t("div",Vt,[Ft,t("button",{type:"button",class:"btn-close","aria-label":"Close",onClick:e[0]||(e[0]=l=>r.closeDeleteModalWindow())})]),t("div",St,[t("h3",null,'是否刪除 "'+P(r.tempItem.title)+'" 商品',1),Et]),t("div",Ot,[t("button",{type:"button",class:"btn btn-outline-secondary",onClick:e[1]||(e[1]=l=>r.closeDeleteModalWindow())}," 取消 "),t("button",{type:"button",class:"btn btn-danger",onClick:e[2]||(e[2]=l=>r.deleteProduct(r.tempItem.id))}," 確認刪除商品 ")])])])],512)}const $t=y(Dt,[["render",Rt]]),{VITE_API:h,VITE_APIPATH:_}={VITE_API:"https://vue3-course-api.hexschool.io/v2",VITE_APIPATH:"cheetah116",BASE_URL:"/vite_hw7_AccordionIsUnabled/",MODE:"production",DEV:!1,PROD:!0};let m="",b="";const Tt={data(){return{isAddProduct:!0,products:[],tempProduct:{imagesUrl:[],productRatingStars:""},arrProducts:[],pageObj:{},fileUpload:null,singleFileInfo:null,formData:new FormData,mainPicUrl:""}},methods:{getData(d=1){this.$http.get(`${h}/api/${_}/admin/products/?page=${d}`).then(e=>{this.products=e.data.products,this.pageObj=e.data.pagination,this.sortData()}).catch(e=>{console.dir(e),alert(e.data)})},openProductModal(d,e){d==="new"?(this.tempProduct={imagesUrl:[]},this.isAddProduct=!0,m.show()):d==="edit"?(this.tempProduct={...e},this.isAddProduct=!1,m.show()):d==="delete"&&(this.tempProduct={...e},this.isAddProduct=!1,b.show())},checkedBtnOperation(d){let e="";if(e=this.checkAllRequiredInput(),e!==""){alert(`"${e}"不可為空白`);return}else m.hide();console.log("根元件this.isAddProduct的值是(true代表要新增產品; false代表要編輯產品)",this.isAddProduct),this.isAddProduct===!0?(console.log("isAddProduct為真, 準備呼叫post API"),this.postProduct()):this.isAddProduct===!1&&(console.log("isAddProduct為假, 準備呼叫update API"),console.log("productId=",d),this.editProduct(d))},postProduct(){this.$http.post(`${h}/api/${_}/admin/product`,{data:this.tempProduct}).then(d=>{console.log(d),alert("建立產品成功!"),this.getData()}).catch(d=>{console.dir(d),alert(d.data.message)})},editProduct(d){this.$http.put(`${h}/api/${_}/admin/product/${d}`,{data:this.tempProduct}).then(e=>{m.hide(),alert("編輯產品成功!"),this.getData()}).catch(e=>{m.hide(),alert(e.data.message),this.getData()})},checkAllRequiredInput(){return this.tempProduct.title===void 0||this.tempProduct.title===""?"標題":this.tempProduct.category===void 0||this.tempProduct.category===""?"分類":this.tempProduct.unit===void 0||this.tempProduct.unit===""?"單位":this.tempProduct.origin_price===void 0||this.tempProduct.origin_price===""?"原價":this.tempProduct.price===void 0||this.tempProduct.price===""?"售價":""},deleteProduct(d){this.$http.delete(`${h}/api/${_}/admin/product/${d}`).then(e=>{b.hide(),alert("已刪除產品!"),this.getData()}).catch(e=>{b.hide(),alert(e.data.message),this.getData()})},createImagesUrlArray(){this.tempProduct.imagesUrl=[],this.tempProduct.imagesUrl.push("")},sortData(){const d=JSON.parse(JSON.stringify(this.products));this.arrProducts=Object.values(d),this.arrProducts.sort(function(e,r){return e.category<r.category?1:-1})},closeProductModal(){m.hide()},closeDeleteModal(){b.hide()},singleFileUpload(){alert("圖片正在上傳中, 請稍後!"),this.singleFileInfo=this.fileUpload.files[0],this.formData.append("file-to-upload",this.singleFileInfo),this.$http.post(`${h}/api/${_}/admin/upload`,this.formData).then(d=>{this.mainPicUrl=d.data.imageUrl,alert("圖片上傳成功"),this.fileUpload.value="",this.formData.delete("file-to-upload"),this.tempProduct.imageUrl=this.mainPicUrl}).catch(d=>{console.log(d),alert(d.data.message),this.fileUpload.value="",this.formData.delete("file-to-upload")})},getModalDataToAddNewProduct(d){this.tempProduct=d,console.log("從Modal收到傳出來的資料後, 執行函式並且將資料賦予給this.tempProduct變數, 其值為",this.tempProduct),this.checkedBtnOperation(this.tempProduct.id)}},components:{PaginationComponent:x,ProductModal:At,DeleteProductModal:$t},mounted(){m=new w(document.getElementById("productModal")),b=new w(document.getElementById("delProductModal")),this.fileUpload=document.querySelector("#pic_file_uploadField"),this.getData()}},Bt={class:"container"},Nt={class:"text-end mt-4"},Lt={class:"table mt-4"},jt=t("thead",null,[t("tr",null,[t("th",{width:"120"}," 分類 "),t("th",null,"產品名稱"),t("th",{width:"120"}," 原價 "),t("th",{width:"120"}," 售價 "),t("th",{width:"100"}," 是否啟用 "),t("th",{width:"120"}," 編輯 ")])],-1),Wt={class:"text-start"},qt={class:"text-start"},Ht={key:0,class:"text-success"},Jt={key:1},zt={class:"btn-group"},Gt=["onClick"],Kt=["onClick"];function Qt(d,e,r,U,o,n){const l=f("ProductModal"),p=f("PaginationComponent"),g=f("DeleteProductModal");return s(),i("div",Bt,[t("div",Nt,[t("button",{class:"btn btn-primary",onClick:e[0]||(e[0]=u=>n.openProductModal("new"))}," 建立新的產品 ")]),t("table",Lt,[jt,t("tbody",null,[(s(!0),i(M,null,k(o.arrProducts,u=>(s(),i("tr",{key:u.title},[t("td",null,P(u.category),1),t("td",null,P(u.title),1),t("td",Wt,P(u.origin_price),1),t("td",qt,P(u.price),1),t("td",null,[u.is_enabled?(s(),i("span",Ht,"啟用")):(s(),i("span",Jt,"未啟用"))]),t("td",null,[t("div",zt,[t("button",{type:"button",class:"btn btn-outline-primary btn-sm",onClick:A=>n.openProductModal("edit",u)}," 編輯 ",8,Gt),t("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:A=>n.openProductModal("delete",u)}," 刪除 ",8,Kt)])])]))),128))])]),v(l,{"temp-product":o.tempProduct,"is-add-product":o.isAddProduct,"create-images-url-array":n.createImagesUrlArray,"close-product-modal-window":n.closeProductModal,"single-file-upload":n.singleFileUpload,onSendNewProductDataFromModal:n.getModalDataToAddNewProduct},null,8,["temp-product","is-add-product","create-images-url-array","close-product-modal-window","single-file-upload","onSendNewProductDataFromModal"]),v(p,{innerpages:o.pageObj,"get-items":n.getData},null,8,["innerpages","get-items"]),v(g,{"temp-item":o.tempProduct,"delete-product":n.deleteProduct,"close-delete-modal-window":n.closeDeleteModal},null,8,["temp-item","delete-product","close-delete-modal-window"])])}const Zt=y(Tt,[["render",Qt]]);export{Zt as default};
